<!DOCTYPE html>
<html>

<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@900&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@500;900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="main.css">
  <meta charset="UTF-8">
  <title>Магазин</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
  <header>
    <div class="categories">
      <div class="category combo-set" onclick="displayProduct('combo-set')"> 
        <h2>Комбо Сеты</h2>
      </div>

      <div class="category roll-set" onclick="displayProduct('roll-set')">
        <h2>Наборы Роллов</h2>
      </div>

      <div class="category number-rolls" onclick="displayProduct('number-rolls')">
        <h2>Цифра Роллы</h2>
      </div>

      <div class="category fish-rolls" onclick="displayProduct('fish-rolls')">
        <h2>Фиш Роллы</h2>
      </div>

      <div class="category nova-set" onclick="displayProduct('nova-set')">
        <h2>Нова Сеты</h2>
      </div>

      <div class="category sushi-set" onclick="displayProduct('sushi-set')">
        <h2>Комплекты Суши</h2>
      </div>

      <div class="category classic-sushi" onclick="displayProduct('classic-sushi')">
        <h2>Суши Классика</h2>
      </div>
    </div>
    <img  class="img14"  src="img/Frame 58.jpg">
 
   


    <div id="cartSection" style="display:none;">
      <h2></h2>
    </div>

    <div class="bottomCart" id="totalPriceSection">
      <h2 class="g1">Общая сумма: 0 ₽</h2>
    </div>

  </header>

  <section id='productSection'>
    <!-- Iframe content / Product display goes here -->
  </section>
  <div id="myModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="close">←&nbsp</span>
        <h2 class="">Корзина</h2>

      </div>
      <div id="paymentModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <span class="paymentClose">←&nbsp</span>
            <h2 class="ots">Выберите способ оплаты</h2>
          </div>
          <button class="form-control1" onclick="setPaymentMethod('Наличными курьеру')">Наличными курьеру</button>
          <button class="form-control1" onclick="setPaymentMethod('Картой курьеру')">Картой курьеру</button>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
        </div>
      </div>
      <div id="productModal" class="modal">
        <div class="modal-content1">
          <div class="modal-header1">
            <span class="productClose">←&nbsp</span>
            <h2 class="">Комплекты Суши</h2>
          </div>
          <div id="productModalContent">
            <!-- Product content goes here -->
          </div>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
        </div>
      </div>
      <div id="cartModalContent"></div>
      <div class="extra-details">
        <div class="input-group">
          <img src="img/zakaz5.svg" width="40px" height="40px">
          <button type="button" id="selectPaymentBtn" class="form-control">Выбрать способ оплаты</button>
        </div>

        <div class="input-group">
          <img src="img/zakaz3.svg" width="40px" height="40px">
          <input type="text" id="orderComment" class="form-control" placeholder="Комментарий к заказу">
        </div>

        <div class="input-group">
          <img src="img/zakaz2.svg" width="40px" height="40px">
          <input type="text" id="promoCode" class="form-control" placeholder="Введите промокод">
        </div>
        <div class="input-group">
          <img src="img/zakaz4.svg" width="40px" height="40px">
          <textarea id="deliveryAddress" class="form-control" placeholder="Введите адрес доставки" onclick="openModal()"></textarea>
       </div>
        </div>
        <div class="input-group">
          <span id="cartTotalPrice" class="form-control">Общая сумма: 0 ₽</span>
        </div>
        <div class="ooo">
          <button id="addToOrderBtn" onclick="openProductModal('sushi-set')">Добавить к заказу</button>
          <button id="checkoutBtn">Оформить заказ</button>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
          <h>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</h>
        </div>
      </div>
      
      
    </div>
  </div>
  <div id="product-description-modal" class="modal-show">
    <div class="modal-content">
      <div class="modal-header5">

        <span onclick="closeProductDescription()">Описание x</span>

      </div>
      <div class="modal-body">
        <img id="product-description-img">
        <div class="headddd">
          <h2 id="product-description-header"></h2>
          <p id="product-description-price"></p>
        </div>

        <p id="product-description-content"></p>
        <div class="product-description-buttons">
        </div>


      </div>
    </div>
  </div>
  <div id="myModal4" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>Заполните данные доставки</h2>
    <input type="text" id="cityInput" placeholder="Город">
    <input type="text" id="streetInput" placeholder="Улица">
    <input type="text" id="houseInput" placeholder="Дом">
    <input type="text" id="buildingInput" placeholder="Корп./стр.">
    <input type="text" id="entranceInput" placeholder="Подъезд">
    <input type="text" id="intercomInput" placeholder="Домофон">
    <input type="text" id="apartmentInput" placeholder="Кв/офис">
    <input type="text" id="floorInput" placeholder="Этаж">
    <textarea id="descriptionInput" placeholder="Описание"></textarea>
    <button onclick="submitForm()">Сохранить</button>
  </div>
</div>
</body>
<script>

  var products = {}; // Will be used to store product information



  var cart = [];
  function loadProducts() {
    products = {
      'combo-set': [{ 'img': 'img/1.jpg', 'name': 'Комбо 19', 'price': '1165 ₽', 'grams': '100 г', 'description': 'Большой чизмаки огурец, Тортильяс, Дракон калифорнийский, Филадельфия классика.Вес: 1115гр' },

      { 'img': 'img/2.jpg', 'name': 'Комбо 18', 'price': '1210 ₽', 'grams': '110 г' },
      { 'img': 'img/3.jpg', 'name': 'Комбо 17', 'price': '1290 ₽', 'grams': '100 г' },
      { 'img': 'img/4.jpg', 'name': 'Комбо 16', 'price': '1350 ₽', 'grams': '120 г' }],
      'roll-set': [
        { 'img': 'img/1.jpg', 'name': 'Комбо 19', 'price': '1165 ₽' },
        { 'img': 'img/2.jpg', 'name': 'Комбо 18', 'price': '1210 ₽' },
        { 'img': 'img/3.jpg', 'name': 'Комбо 17', 'price': '1290 ₽' },
        { 'img': 'img/4.jpg', 'name': 'Комбо 16', 'price': '1350 ₽' }
      ],
      'number-rolls': [
        { 'img': 'img/1.jpg', 'name': 'Комбо 19', 'price': '1165 ₽' },
        { 'img': 'img/2.jpg', 'name': 'Комбо 18', 'price': '1210 ₽' },
        { 'img': 'img/3.jpg', 'name': 'Комбо 17', 'price': '1290 ₽' },
        { 'img': 'img/4.jpg', 'name': 'Комбо 16', 'price': '1350 ₽' }
      ],
      'fish-rolls': [
        { 'img': 'img/1.jpg', 'name': 'Комбо 19', 'price': '1165 ₽' },
        { 'img': 'img/2.jpg', 'name': 'Комбо 18', 'price': '1210 ₽' },
        { 'img': 'img/3.jpg', 'name': 'Комбо 17', 'price': '1290 ₽' },
        { 'img': 'img/4.jpg', 'name': 'Комбо 16', 'price': '1350 ₽' }
      ],
      'nova-set': [
        { 'img': 'img/1.jpg', 'name': 'Комбо 19', 'price': '1165 ₽' },
        { 'img': 'img/2.jpg', 'name': 'Комбо 18', 'price': '1210 ₽' },
        { 'img': 'img/3.jpg', 'name': 'Комбо 17', 'price': '1290 ₽' },
        { 'img': 'img/4.jpg', 'name': 'Комбо 16', 'price': '1350 ₽' }
      ],
      'sushi-set': [
        { 'img': 'img/k7.jpg', 'name': 'Палочки', 'price': '3 ₽', 'grams': '0 г' },
        { 'img': 'img/k4.jpg', 'name': 'Васаби', 'price': '15 ₽', 'grams': '20 г' },
        { 'img': 'img/k6.jpg', 'name': 'Имбирь', 'price': '15 ₽', 'grams': '100 г' },
        { 'img': 'img/k3.jpg', 'name': 'Комплект', 'price': '30 ₽', 'grams': '100 г' },
        { 'img': 'img/k5.jpg', 'name': 'Соевый соус', 'price': '15 ₽', 'grams': '100 мл' },
        { 'img': 'img/k1.jpg', 'name': 'Соус тар-тар', 'price': '25 ₽', 'grams': '50 мл' },
        { 'img': 'img/k2.jpg', 'name': 'Соус спайси', 'price': '25 ₽', 'grams': '50 мл' }
      ],
      'classic-sushi': [
        { 'img': 'img/s1.jpg', 'name': 'Комбо 19', 'price': '1165 ₽', 'grams': '100 г' },
        { 'img': 'img/s2.jpg', 'name': 'Комбо 18', 'price': '1210 ₽', 'grams': '100 г' },
        { 'img': 'img/s3.jpg', 'name': 'Комбо 17', 'price': '1290 ₽', 'grams': '100 г' },
        { 'img': 'img/s4.jpg', 'name': 'Комбо 16', 'price': '1350 ₽', 'grams': '100 г' }
      ]
    }

  };
  function addToCart(category, productIndex) {
    var product = products[category][productIndex];

    // добавляем свойство category в каждый продукт
    product.category = category;

    var existingProduct = cart.find((item) => item.name === product.name && item.category === product.category);

    if (existingProduct) {
      existingProduct.quantity++;
    } else {
      product.quantity = 1;
      cart.push(product);
    }

    displayCart();
  }

  function removeFromCart(index) {
    cart.splice(index, 1);
    displayCart();
  }
  function increaseQuantityInCart(index) {
    cart[index].quantity++;
    displayCart();
  }
  function decreaseQuantityInCart(index) {
    if (cart[index].quantity > 1) {
      cart[index].quantity--;
    } else {
      removeFromCart(index);
    }

    displayCart();
  }

  function displayCart() {
    const cartSection = document.getElementById('cartModalContent');
    const bottomCart = document.getElementById('totalPriceSection'); // Получаем доступ к bottomCart
    let totalPrice = 0;
    let innerHTML = `<h2 class="ots"></h2><div class="cart">`;

    if (cart.length > 0) {
      bottomCart.classList.add("bottomCart-show"); // Show bottomCart 
    } else {
      bottomCart.classList.remove("bottomCart-show"); // Hide bottomCart 
    }

    for (let i = 0; i < cart.length; i++) {
      totalPrice += parseInt(cart[i].price.replace(" ₽", "")) * cart[i].quantity;
      window.totalPrice = totalPrice;
      innerHTML += `
<div class="product-details">
  <img src=${cart[i].img} alt=${cart[i].name}>
  <div>
    <div class="ed">
    <h2 class="tovartext">${cart[i].name}</h2>
    <p class="tovartext1">${cart[i].price}</p>
    </div>
    <div class="botb">
    <button onclick="decreaseQuantityInCart(${i})">-</button>${cart[i].quantity} 
    <button onclick="increaseQuantityInCart(${i})">+</button></div>

  </div>              
</div>`;
    }

    cartSection.innerHTML = innerHTML;
    document.getElementById('cartTotalPrice').innerText = `Общая сумма: ${totalPrice} ₽`;

    document.getElementById('totalPriceSection').innerHTML = `<h2 class="g1">ОФОРМИТЬ ЗАКАЗ: ${totalPrice} ₽</h2>`;
  }
  
  function displayProduct(productType) {
    const section = document.getElementById('productSection');
    var innerHTML = '';
    const categoryElements = document.querySelectorAll(".category");
    categoryElements.forEach((el) => {
      // Удалем класс .category-selected у всех элементов
      el.classList.remove("category-selected");
      // Добавляем класс .category-selected выбранному элементу
      if (el.classList.contains(productType)) {
        el.classList.add("category-selected");
      }
    });
    for (let i = 0; i < products[productType].length; i++) {
      innerHTML += `
  <div class="product">
    <img src=${products[productType][i].img} alt=${products[productType][i].name} onclick="openProductDescription('${productType}', ${i})">
    <h2>${products[productType][i].name}</h2>
    <p>${products[productType][i].price} &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp ${products[productType][i].grams}</p>
    <div class="product-quantity">
      <button class="boldMontserrat" onclick="addToCart('${productType}', ${i})">ДОБАВИТЬ</button>
    </div>
  </div>`;


    }


    section.innerHTML = innerHTML;
  }
  
  window.onload = loadProducts;

</script>
<script>
  // Your JS for products, etc



  // Rest of your JS code
  var modal = document.getElementById("myModal");

  function openCart() {
    displayCart();
    modal.style.display = "block";
  }

  document.getElementById('totalPriceSection').addEventListener('click', openCart);

  var span = document.getElementsByClassName("close")[0];

  // устанавливаем событие на крестик
  span.onclick = function () {
    modal.style.display = "none";
  }

  window.onclick = function (event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }

  document.getElementById('cartModalContent').style.marginTop = "10px";
</script>
<script>;
  function checkInputs() {
    let address = document.getElementById("deliveryAddress");
    let payment = document.getElementById("selectPaymentBtn");
    let checkoutBtn = document.getElementById("checkoutBtn");

    address.addEventListener("input", validateInput);
    payment.addEventListener("click", validateInput);

    function validateInput() {
      if (address.value !== "" && payment.innerHTML !== "Выбрать способ оплаты" && window.totalPrice > 500) {
        checkoutBtn.disabled = false;
        checkoutBtn.style.backgroundColor = "#ffffff"; //MOdify the color to match your style
        checkoutBtn.style.cursor = "pointer";
      } else {
        checkoutBtn.disabled = true;
        checkoutBtn.style.backgroundColor = "#cccccc"; //MOdify the color to match your style
        checkoutBtn.style.cursor = "not-allowed";
      }
    }

    // Call validateInput initially to ensure the button state is updated on page refresh
    validateInput();
  }

  window.onload = function () {
    loadProducts();
    displayProduct('combo-set');
    checkInputs();

    // Получаем элементы модального окна
    var paymentModal = document.getElementById("paymentModal");
    var paymentBtn = document.getElementById("selectPaymentBtn");
    var paymentClose = document.getElementsByClassName("paymentClose")[0];

    // Когда пользователь нажимает на кнопку, открываем модальное окно 
    paymentBtn.onclick = function () {
      paymentModal.style.display = "block";
    }

    // Когда пользователь нажимает на <span> (x), закрываем модальное окно
    paymentClose.onclick = function () {
      paymentModal.style.display = "none";
    }

    // Если пользователь нажимает где-то вне модального окна, закрываем его
    window.onclick = function (event) {
      if (event.target == paymentModal) {
        paymentModal.style.display = "none";
      }
    }

    // Устанавливаем выбранный способ оплаты и закрываем модальное окно
    window.setPaymentMethod = function (method) {
      paymentBtn.innerText = method;
      paymentModal.style.display = "none";
    }
  }
</script>
<script>
  function openProductModal(productType) {
    displayProduct(productType);
    document.getElementById('productModalContent').innerHTML = document.getElementById('productSection').innerHTML;
    document.getElementById('productModal').style.display = "block";
  }
  var productModal = document.getElementById('productModal');
  var productClose = document.getElementsByClassName('productClose')[0];

  productClose.onclick = function () {
    productModal.style.display = "none";
  };

  window.onclick = function (event) {
    if (event.target == productModal) {
      productModal.style.display = "none";
    }
  };
</script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  let tg = window.Telegram.WebApp;
  let checkoutBtn = document.getElementById("checkoutBtn")

  checkoutBtn.addEventListener("click", function () {
    let paymentMethod = document.getElementById("selectPaymentBtn").innerText;
    let promoCode = document.getElementById("promoCode").value;
    let orderComment = document.getElementById("orderComment").value; // Получаем комментарии к заказу
    let deliveryAddress = document.getElementById("deliveryAddress").value; // Получаем адрес доставки
    let totalPrice = window.totalPrice;
    let productsInCart = cart.map(product => {
      return {
        name: product.name,
        quantity: product.quantity,
        price: product.price
      }
    });

    tg.expand();
    let data = {
      promoCode: promoCode,
      orderComment: orderComment,
      deliveryAddress: deliveryAddress,
      productsInCart: productsInCart,
      totalPrice: totalPrice,
      paymentMethod: paymentMethod
    }
    tg.sendData(JSON.stringify(data));
    tg.close();

  });
</script>
<script>
  const slider = document.querySelector('.categories');
  let isDown = false;
  let startX;
  let scrollLeft;

  slider.addEventListener('mousedown', (e) => {
    isDown = true;
    slider.classList.add('active');
    startX = e.pageX - slider.offsetLeft;
    scrollLeft = slider.scrollLeft;
  });
  slider.addEventListener('mouseleave', () => {
    isDown = false;
    slider.classList.remove('active');
  });
  slider.addEventListener('mouseup', () => {
    isDown = false;
    slider.classList.remove('active');
  });
  slider.addEventListener('mousemove', (e) => {
    if (!isDown) return;
    e.preventDefault();
    const x = e.pageX - slider.offsetLeft;
    const walk = (x - startX) * 3; //scroll-fast
    slider.scrollLeft = scrollLeft - walk;
  });
</script>
<script>
  function openProductDescription(category, productIndex) {
    const product = products[category][productIndex];
    const productModal = document.getElementById('product-description-modal');

    document.getElementById('product-description-header').innerText = product.name;
    document.getElementById('product-description-content').innerText = product.description;
    document.getElementById('product-description-price').innerText = product.price;
    document.getElementById('product-description-img').src = product.img;

    productModal.style.display = "block";
  }

</script>
<script>
  function closeProductDescription() {
    document.getElementById('product-description-modal').style.display = "none";
  }

  window.onclick = function (event) {
    if (event.target == document.getElementById('product-description-modal')) {
      closeProductDescription();
    }
  }
</script>
<script>
  function openModal() {
  var modal = document.getElementById("myModal4");
  modal.style.display = "block";
}

function closeModal() {
  var modal = document.getElementById("myModal4");
  modal.style.display = "none";
}

function submitForm() {
  // Получение значений полей ввода
  var city = document.getElementById("cityInput").value;
  var street = document.getElementById("streetInput").value;
  var house = document.getElementById("houseInput").value;
  var building = document.getElementById("buildingInput").value;
  var entrance = document.getElementById("entranceInput").value;
  var intercom = document.getElementById("intercomInput").value;
  var apartment = document.getElementById("apartmentInput").value;
  var floor = document.getElementById("floorInput").value;
  var description = document.getElementById("descriptionInput").value;

  // Обработка полученных значений
  var deliveryAddress = city + ", " + street + ", " + house;
  if (building) {
    deliveryAddress += ", " + building;
  }
  if (entrance) {
    deliveryAddress += ", подъезд " + entrance;
  }
  if (intercom) {
    deliveryAddress += ", код домофона " + intercom;
  }
  if (apartment) {
    deliveryAddress += ", кв. " + apartment;
  }
  if (floor) {
    deliveryAddress += ", этаж " + floor;
  }
  
  // Обновление поля ввода адреса доставки
  var deliveryAddressInput = document.getElementById("deliveryAddress");
  deliveryAddressInput.value = deliveryAddress;
  
  // Создание запроса к геокодеру
  var requestUrl = "https://geocode-maps.yandex.ru/1.x/?apikey=1ea750ee-f842-4fbf-a439-6aaa3bb83c0b&format=json&geocode=" + deliveryAddress;

  // Отправка запроса
  fetch(requestUrl)
    .then(function(response) {
      return response.json();
    })
    .then(function(data) {
      // Обработка полученных данных
      var coordinates = data.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(' ');
      var latitude = coordinates[1];
      var longitude = coordinates[0];

      // Дальнейшая обработка данных, если нужно
      // ...
    })
    .catch(function(error) {
      console.log(error);
      // Обработка ошибки, если нужно
      // ...
    });
}
</script>


</html>
